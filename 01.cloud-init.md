# cloud-init

AL2023 には、cloud-init のカスタマイズバージョンが含まれている為、cloud-initについて調査する。

## cloud-initとは


geminiの回答は以下の通り

``` text
cloud-initは、クラウドインスタンスの初期化を自動化するツールです。クラウド環境で新しい仮想マシン（インスタンス）が作成されると、cloud-initは自動的に実行され、様々な初期設定を行います。これにより、手動で設定する手間を省き、インスタンスを迅速に稼働させることができます。

cloud-initが担う主な役割
ユーザーデータの処理: インスタンス作成時に指定したユーザーデータ（テキスト形式のスクリプト）を実行し、ソフトウェアのインストール、ファイルの配置、サービスの起動などを行います。
メタデータの取得: インスタンスに関する情報（IPアドレス、ホスト名、リージョンなど）をメタデータサービスから取得し、システムに設定します。
ネットワーク設定: ネットワークインターフェースの設定、DHCPによるIPアドレスの取得などを行います。
SSHキーのインストール: SSHキーをインストールし、リモートアクセスを可能にします。

### cloud-initのメリット
自動化: 手動での設定作業を大幅に削減し、初期化時間を短縮できます。
柔軟性: ユーザーデータで様々なカスタマイズが可能で、多様な環境に対応できます。
標準化: 多くのクラウドプラットフォームでサポートされており、共通の仕組みでインスタンスを初期化できます。

### cloud-initの利用例
特定のソフトウェアのインストール: Webサーバー、データベース、監視ツールなどのインストール
カスタムスクリプトの実行: バックアップスクリプト、ログ収集スクリプトの実行
ファイルの配置: 設定ファイル、初期データの配置
ネットワークの設定: 静的IPアドレスの設定、VPN接続の設定

### まとめ
cloud-initは、クラウド環境におけるインスタンスの初期化を効率化するための重要なツールです。cloud-initを利用することで、手作業による設定ミスを減らし、インフラの構築時間を短縮することができます。

より詳しく知りたい方へ
cloud-initの詳細については、以下の公式ドキュメントをご参照ください。

cloud-init公式ドキュメント: https://cloudinit.readthedocs.io/en/latest/
```

## カスタマイズ内容

- AL2023 は /etc/cloud/cloud.cfg.d と /etc/cloud/cloud.cfg にある cloud-init アクションを使用
- 独自の cloud-init アクションファイルを /etc/cloud/cloud.cfg.d ディレクトリに作成
- cloud-init がインスタンスを起動すると、cloud-init パッケージは以下の設定タスクを実行

  - デフォルトのロケールの設定
  - ホスト名の設定
  - ユーザーデータの解析および処理
  - ホストプライベート SSH キーの生成
  - 容易にログインおよび管理できるように、ユーザーのパブリック SSH キーを .ssh/authorized_keys に追加
  - パッケージ管理のためのリポジトリの準備
  - user-data で定義されたパッケージアクションの処理
  - user-data に含まれるユーザースクリプトの実行
  - インスタンスストアボリュームのマウント (該当する場合)

## 参考

[チュートリアル — cloud-init 22.2.2 ドキュメント](https://cloudinit.readthedocs.io/en/22.2.2/topics/tutorial.html#lxd-tutorial)